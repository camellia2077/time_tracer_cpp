## v0.5.0 - 2026-01-26

### 架构与重构 (Architecture & Refactoring)
* **[Core] 统一时间范围报告体系 (Unified Range Reporting)**：引入 `RangeReportService` 与 `RangeReportData`，将原本独立的“月报” (`Monthly`) 和“时段报” (`Period`) 逻辑合并为通用的“时间范围”逻辑。这一重构消除了大量重复代码，使系统原生支持周报、年报或任意自定义时间段的报告生成。
* **[Data] 落地仓储模式 (Repository Pattern)**：新增 `IReportRepository` 接口与 `SqliteReportRepository` 实现，将 SQL 查询逻辑从 Service 层彻底剥离。Service 层现在仅通过接口请求数据，不再直接依赖 SQLite 实现，显著提升了业务逻辑的纯净度与可测试性。
* **[Formatter] 实现通用格式化层 (Generic Formatters)**：实现了通用的 `RangeMdFormatter`、`RangeTexFormatter` 和 `RangeTypFormatter`。这套新的格式化器能够适配任意时间范围的数据模型，取代了原有硬编码的月度/时段格式化器，实现了表现层的逻辑复用。
* **[ReportService] 实现依赖注入模式**：重构了 `ReportService` 的核心逻辑，不再在服务内部硬编码依赖。现在通过组装 `Fetcher`/`Repository`（数据获取）、`Provider`（项目信息）和 `Config` 来初始化具体的报告服务。
* **[Data] 集成批量数据获取器**：全面接入 `BatchDayDataFetcher` 等组件，优化了数据的批量查询性能（针对原有旧接口的兼容优化）。
* **[Infrastructure] IO与导出解耦**：在导出流程中引入了 `IO::DiskFileSystem` 和 `LocalConsoleNotifier`，并将它们注入到 `Exporter` 中。这使得文件系统操作和用户通知逻辑与报告生成逻辑彻底分离，提高了系统的可测试性和扩展性。
* **[Interface] 接入 IProjectInfoProvider**：通过 `IProjectInfoProvider` 接口包装单例 `ProjectNameCache`，降低了服务层对静态单例的直接耦合。

## v0.5.1 - 2026-01-27

### 新增功能 (Features)

* **周报系统 (Weekly Reports)**: 全面支持周报的查询、单次导出及批量导出功能。
* **查询命令**: 新增 `query week <year> <week_num>`，例如 `query week 2026 4` 可直接生成第 4 周的统计报告。
* **导出命令**: 新增 `export week <year> <week_num>`，支持将特定周报导出为 Markdown, LaTeX 或 Typst 格式。
* **批量导出**: 新增 `export all-week` 命令，可一次性导出数据库中所有历史周报，自动按年份归档。
* **文件管理**: 导出的周报将自动保存至 `export/<format>/weekly/<Year>/` 目录下，文件名为 `<Year>-W<Week>.md`（例如 `2026-W04.md`）。


* **周报独立配置**:
* 引入了专门针对周报的配置文件 (`WeekMdConfig.toml`, `WeekTexConfig.toml`, `WeekTypConfig.toml`)。
* 支持自定义周报标题前缀（例如 "Weekly Summary for"）及特定样式，与月报和周期报配置解耦。



### 代码重构 (Refactoring)

* **RangeReportService 升级**: 重构了范围报告服务，引入 `RangeType` 枚举 (Week, Month, Period)。
* 不再让所有范围报告共享同一套配置，而是根据类型自动加载对应的 TOML 配置（Week/Month/Period），实现了配置的精确隔离。


* **日期计算逻辑**: 在 `shared/utils` 中完善了 `get_week_date_range` 和 `get_period_dates` 工具函数，统一了底层的日期计算逻辑。
* **配置加载层**: 更新了 `ConfigLoader` 和 `AppConfig`，支持动态解析并加载新增的周报配置文件路径。



### 修复

* **修复报告格式化器注册缺失导致的导出失败问题**：在 `ReportHandler` 初始化阶段增加了格式化器插件的显式注册逻辑。修复了 `GenericFormatterFactory` 在运行时无法找到 Markdown、LaTeX 和 Typst 对应插件，从而导致 `query` 和 `export` 命令报错 "Unsupported report format" 的问题。
* **修复项目名称缓存未加载导致的报告内容缺失问题**：在 `SqliteReportRepository` 初始化时增加了项目名称缓存的显式加载。修复了日报中 "All Activities" 列表缺少活动名称以及 "Project Breakdown" 章节丢失的问题。


## v0.5.2 - 2026-01-27
### 架构重构 (Architecture Refactoring)

* **[Refactor] Core/Application 分层拆分**:
    * 将 `src/core/application` 目录独立为顶层模块 `src/application`。
    * **Application Layer (应用层)**: 专注于业务流程编排、命令处理 (Command/Handler) 和 Pipeline 执行。
    * **Core Layer (核心层)**: 专注于纯粹的领域模型 (Domain) 和基础设施实现 (Infrastructure)。
    * 通过物理隔离进一步明确了“业务编排”与“底层支撑”的界限，增强了架构的清晰度。
* **[Build] CMake 构建优化**: 更新了 `SourceFileCollection.cmake`，将 application 源文件与 core 源文件分离管理 (`APPLICATION_SOURCES` vs `CORE_SOURCES`)。

### 修复 (Fixes)

* **[Fix] 编译错误修复**: 修复了 `logic_validator_step` 和 `cli_application` 中的变量声明缺失及代码注释错误。


## v0.5.3 - 2026-01-28

### 架构重构 (Architecture Refactoring)

* **[Refactor] 依赖倒置重构 (Dependency Inversion Refactoring)**:
    *   **接口下沉**: 将 `IFileSystem` 和 `IUserNotifier` 接口从 `application/interfaces/` 移动到 `core/domain/ports/`，确保 config 层和 core/infrastructure 层不再反向依赖 application 层。
    *   **消除 core→reports 反向依赖**: 
        *   将 `ReportFormat` 类型从 `reports/core/types/` 移动到 `core/domain/types/`。
        *   将 `QueryDataStructs` 模型从 `reports/domain/model/` 移动到 `core/domain/model/`。
    *   **reports/core 重命名**: 将 `reports/core/` 目录重命名为 `reports/shared/`，避免与顶层 `core/` 模块混淆。
    *   **application 目录整理**: 
        *   将 `pipeline_factory.*` 和 `pipeline_runner.*` 移动到 `application/pipeline/` 子目录。
        *   删除冗余的 `application/ports/` 目录。

### 技术改进 (Technical Improvements)

* **[Build] CMake 配置更新**: 更新了 `SourceFileCollection.cmake` 中的源文件路径以匹配新的目录结构。
* **[Docs] 架构文档更新**: 更新了 `architecture.md`，反映新的依赖层次结构和目录组织。


## v0.5.4 - 2026-01-28

### 代码规范化 (Code Style Normalization)

本次更新按照 **Google C++ 开源项目风格指南** 对项目进行命名规范化重构，主要将方法名从 `snake_case` 统一为 `PascalCase`。

#### 已完成的重构

* **[Interface] 接口层方法命名规范化**:
    * `IFileSystem`: `read_content` → `ReadContent`, `find_files` → `FindFiles`, `exists` → `Exists`, `is_directory` → `IsDirectory`, `create_directories` → `CreateDirectories`, `write_content` → `WriteContent` 等
    * `IUserNotifier`: `notify_info` → `NotifyInfo`, `notify_error` → `NotifyError`, `notify_success` → `NotifySuccess`, `notify_warning` → `NotifyWarning`
    * `ILogSerializer`: `serialize` → `Serialize`, `deserialize` → `Deserialize`
    * `ILogConverter`: `convert` → `Convert`
    * `IReportRepository`: `get_daily_report` → `GetDailyReport`, `get_weekly_report` → `GetWeeklyReport` 等

* **[Implementation] 实现层同步更新**:
    * `io/DiskFileSystem`: 所有方法实现改为 PascalCase
    * `serializer/JsonSerializer`: 所有方法实现改为 PascalCase
    * `converter/LogProcessor`: `convert` → `Convert`

* **[Caller] 调用层同步更新**:
    * `config/`: `config_loader.cpp`, `parser_utils.cpp`, `converter_loader.cpp`, `plugin_validator.cpp`
    * `application/steps/`: 全部 7 个 step 文件
    * `application/handlers/`: `ingest_handler.cpp`, `export_handler.cpp`
    * `application/service/`: `workflow_handler.cpp`, `report_generator.cpp`
    * `application/utils/`: `processed_data_writer.cpp`, `converter_config_factory.cpp`
    * `cli/`: `cli_application.cpp`


## v0.5.5 - 2026-01-29

### 新增功能 (Features)
* **[Report] 年报系统 (Yearly Reports)**：实现了对年份数据的完整支持，包括 `day`, `week`, `month`, `year` 系列命令的闭环，支持单年导出及 `all-year` 批量导出。
* **[Report] 自定义范围报告 (Range Reports)**：支持导出任意自定义闭区间的时间段报告，用户可通过 `query range <start> <end>` 灵活获取统计。

### 架构与重构 (Architecture & Refactoring)
* **[Core] 语义化重构 (Semantic Refactoring)**：将语焉不详的 `Period`（时端报）统一重构为 `Recent`（近期报告），专门负责“最近 N 天”的动态统计，提升了代码的可读性与语义一致性。
* **[CLI] 命令命名标准化 (Noun-based Naming)**：对 CLI 子命令进行规范化，统一剔除 `-ly` 后缀，使用名词形式 (`day`, `week`, `month`, `year`)，并将批量操作统一为 `all-` 前缀（如 `all-day`, `all-week`）。
* **[CLI] 帮助信息布局优化**：按功能模块（摄入、验证、报表）对命令进行分组，并优化了 `export` 和 `query` 的参数说明，极大提升了 CLI 的直观性。
* **[Service] 逻辑复用升级**：`RangeReportService` 现已完全整合 `Year`, `Recent`, `Month`, `Week`, `Range` 五种报告维度，实现了底层逻辑的高度复用。

### 文档与规范 (Documentation & Standards)
* **[Docs] 文档体系同步更新**：更新了开发指南 `how_to_add_new_report.md` 并补全了 `cli/README.md`，明确了 CLI 命令的命名准则，为后续扩展奠定基础。

### 修复 (Fixes)
* **[Fix] 修复重构引发的编译错误**：解决了 `export_handler.cpp` 和 `all_commands.cpp` 中因子命令重命名导致的调用中断问题。
* **[Fix] 修正 Python 测试套件属性引用错误**：解决了 `ExportTester` 在处理批量导出模式时的 `AttributeError` 问题，确保测试覆盖度。
