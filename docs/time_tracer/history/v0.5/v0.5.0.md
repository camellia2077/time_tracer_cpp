## v0.5.0 - 2026-01-26

### 架构与重构 (Architecture & Refactoring)
* **[Core] 统一时间范围报告体系 (Unified Range Reporting)**：引入 `RangeReportService` 与 `RangeReportData`，将原本独立的“月报” (`Monthly`) 和“时段报” (`Period`) 逻辑合并为通用的“时间范围”逻辑。这一重构消除了大量重复代码，使系统原生支持周报、年报或任意自定义时间段的报告生成。
* **[Data] 落地仓储模式 (Repository Pattern)**：新增 `IReportRepository` 接口与 `SqliteReportRepository` 实现，将 SQL 查询逻辑从 Service 层彻底剥离。Service 层现在仅通过接口请求数据，不再直接依赖 SQLite 实现，显著提升了业务逻辑的纯净度与可测试性。
* **[Formatter] 实现通用格式化层 (Generic Formatters)**：实现了通用的 `RangeMdFormatter`、`RangeTexFormatter` 和 `RangeTypFormatter`。这套新的格式化器能够适配任意时间范围的数据模型，取代了原有硬编码的月度/时段格式化器，实现了表现层的逻辑复用。
* **[ReportService] 实现依赖注入模式**：重构了 `ReportService` 的核心逻辑，不再在服务内部硬编码依赖。现在通过组装 `Fetcher`/`Repository`（数据获取）、`Provider`（项目信息）和 `Config` 来初始化具体的报告服务。
* **[Data] 集成批量数据获取器**：全面接入 `BatchDayDataFetcher` 等组件，优化了数据的批量查询性能（针对原有旧接口的兼容优化）。
* **[Infrastructure] IO与导出解耦**：在导出流程中引入了 `IO::DiskFileSystem` 和 `LocalConsoleNotifier`，并将它们注入到 `Exporter` 中。这使得文件系统操作和用户通知逻辑与报告生成逻辑彻底分离，提高了系统的可测试性和扩展性。
* **[Interface] 接入 IProjectInfoProvider**：通过 `IProjectInfoProvider` 接口包装单例 `ProjectNameCache`，降低了服务层对静态单例的直接耦合。

## v0.5.1 - 2026-01-27

### 新增功能 (Features)

* **周报系统 (Weekly Reports)**: 全面支持周报的查询、单次导出及批量导出功能。
* **查询命令**: 新增 `query week <year> <week_num>`，例如 `query week 2026 4` 可直接生成第 4 周的统计报告。
* **导出命令**: 新增 `export week <year> <week_num>`，支持将特定周报导出为 Markdown, LaTeX 或 Typst 格式。
* **批量导出**: 新增 `export all-week` 命令，可一次性导出数据库中所有历史周报，自动按年份归档。
* **文件管理**: 导出的周报将自动保存至 `export/<format>/weekly/<Year>/` 目录下，文件名为 `<Year>-W<Week>.md`（例如 `2026-W04.md`）。


* **周报独立配置**:
* 引入了专门针对周报的配置文件 (`WeekMdConfig.toml`, `WeekTexConfig.toml`, `WeekTypConfig.toml`)。
* 支持自定义周报标题前缀（例如 "Weekly Summary for"）及特定样式，与月报和周期报配置解耦。



### 代码重构 (Refactoring)

* **RangeReportService 升级**: 重构了范围报告服务，引入 `RangeType` 枚举 (Week, Month, Period)。
* 不再让所有范围报告共享同一套配置，而是根据类型自动加载对应的 TOML 配置（Week/Month/Period），实现了配置的精确隔离。


* **日期计算逻辑**: 在 `shared/utils` 中完善了 `get_week_date_range` 和 `get_period_dates` 工具函数，统一了底层的日期计算逻辑。
* **配置加载层**: 更新了 `ConfigLoader` 和 `AppConfig`，支持动态解析并加载新增的周报配置文件路径。



### 修复

* **修复报告格式化器注册缺失导致的导出失败问题**：在 `ReportHandler` 初始化阶段增加了格式化器插件的显式注册逻辑。修复了 `GenericFormatterFactory` 在运行时无法找到 Markdown、LaTeX 和 Typst 对应插件，从而导致 `query` 和 `export` 命令报错 "Unsupported report format" 的问题。
* **修复项目名称缓存未加载导致的报告内容缺失问题**：在 `SqliteReportRepository` 初始化时增加了项目名称缓存的显式加载。修复了日报中 "All Activities" 列表缺少活动名称以及 "Project Breakdown" 章节丢失的问题。