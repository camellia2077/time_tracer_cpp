## v0.4.1.0 - 2026-01-14

### Refactor

* **解耦 `DateCheckMode` 枚举定义**：
* 将 `DateCheckMode` 枚举从业务层 (`converter/validator/common/ValidatorUtils.hpp`) 移动到基础通用层 (`common/types/DateCheckMode.hpp`)。
* **目的**：解决 `AppConfig` (Common层) 依赖 `Converter` (业务层) 的反向依赖问题。现在 `Config` 和 `Converter` 都依赖于底层的 `Types`，实现了更清晰的分层架构，方便独立测试。


### Features

* **新增 `save_processed_output` 配置项**：
* 在 `config.json` 的 `system` 节点下增加了 `save_processed_output` 选项（默认为 `true` 或 `false`）。
* 实现了优先级逻辑：**CLI 参数 (`--save-processed` / `--no-save`) > 配置文件 (`config.json`)**。


* **新增 `--no-save` 命令行参数**：
* 允许在配置文件默认开启保存的情况下，通过命令行强制不保存中间文件。



## v0.4.1.1 - 2026-01-14

根据你提供的 `converter` 模块文件内容（如 `ConverterStep.cpp` 使用了工厂模式，`LogProcessor` 改用 `ConverterConfig` 等），该模块也进行了类似的解耦重构。

以下是补充了 **Converter (转换器)** 相关变动后的完整更新说明：

## v0.4.1.1 - 2026-01-14

### 重构 (Refactor)

* **配置系统全面解耦**:
* **报表模块 (`reports`)**: 完成与 JSON 的彻底解耦。引入纯 C++ 结构体 (`ReportConfigModels`) 承载配置数据，新增 `ReportConfigLoader` 集中处理解析映射。
* **转换器模块 (`converter`)**: 同步完成配置解耦。
* 引入 `ConverterConfig` 结构体替代原始 JSON 传递，使 `LogProcessor` 等核心组件依赖于类型安全的配置对象。
* 新增 `ConverterConfigFactory`，将复杂的配置合并（Merge）与加载逻辑封装在工厂内部。

* **配置加载优化**: 重构 `ConfigLoader`，将 JSON 解析逻辑拆分至 `ConfigParserUtils`，大幅降低代码复杂度并提升职责清晰度。

### 稳定性 (Stability)

* **类型安全增强**: 配置错误（如拼写或类型不匹配）现在会在程序启动加载阶段被捕获，消除了生成报表和数据转换时的潜在运行时崩溃风险。



## v0.4.1.2 - 2026-01-14

### 核心变更：配置系统升级 (TOML Support)

* **从 JSON 迁移至 TOML**: 核心转换器 (`Converter`) 的配置文件格式从 `.json` 全面切换为 `.toml`，以提供更好的可读性和编辑体验。
* 引入了 `toml++` 库作为新的解析后端 。


* 新增 `TomlConverterConfigLoader`，替代原有的 JSON 加载器 。


* 更新 `ConverterConfigFactory`，支持加载和递归合并 TOML 格式的配置文件（如 `mapping_config.toml` 和 `duration_rules.toml`）。



### 架构优化：启动流程精简

* **StartupValidator 职责瘦身**: 移除了启动时对所有业务配置文件的强制逻辑校验（Over-engineering）。
* 现在的 `StartupValidator` 仅专注于检查**运行时环境的完整性**（即确保 `plugins` 目录下的 DLL 和核心库 `reports_shared.dll` 存在）。
* 配置文件的详细逻辑验证被推迟到具体执行命令（如 `run` 或 `validate`）时进行，提高了程序的启动速度和容错性。



### 构建系统改进 (CMake)

* **集成 tomlplusplus**: 更新 CMake 配置以查找并链接 `tomlplusplus` 库。
* **DLL 依赖管理修复**:
* 修正了 `Win32PostBuildCopy.cmake` 和 `Packaging.cmake` 中对 `tomlplusplus` 动态库文件名的引用，适配 MSYS2 UCRT64 环境下的版本后缀（`libtomlplusplus-3.dll`）。
* 确保打包和安装时正确包含所有必要的运行时依赖。



### 代码修复与重构

* **编译错误修复**:
* 解决了 `toml++` 返回的 `std::string_view` 无法直接作为 `std::unordered_map` 键值的问题，添加了显式的类型转换 。


* 修正了验证规则类（`MainRule`, `MappingRule` 等）在 `.cpp` 实现文件中的函数签名，使其与头文件中更新后的 `toml::table` 参数类型保持一致。


* **接口同步**: 更新了 `ConverterFacade` 和 `ConfigFacade` 接口，使其适配新的配置数据结构。



## v0.4.1.3 - 2026-01-15

###


基于你提供的文件变更内容和上下文，以下是针对 `config` 模块更新的 Changelog 总结：

## v0.4.1.3 - 2026-01-15

### Refactor (重构)

* **配置格式迁移 (JSON -> TOML)**:
* 完成 `Reports` (日报/月报/周期报表) 及 `Converter` (转换器) 相关配置文件的格式迁移，全面采用 **TOML** 格式以提升可读性与维护性。
* 主配置文件入口变更为 `config.toml`。


* **Loader 模块重构**:
* **ReportConfigLoader**: 更新所有报表加载逻辑（Tex/Typ/Md），移除 JSON 依赖，通过 `TomlLoaderUtils` 实现对 TOML 文件的解析与结构填充。
* **TomlLoaderUtils**: 新增通用 TOML 解析工具类，封装了必需字段检查 (`get_required`)、可选值处理及 `statistics_items` 的递归解析逻辑。
* **ConfigParserUtils**: 重构 `parse_system_settings`, `parse_pipeline_settings` 等函数以适配 `toml::table` 数据结构。


* **Validator 模块适配**:
* **策略接口更新**: `IQueryStrategy` 及其实现类 (`BaseStrategy`, `DailyTex` 等) 的验证入口参数从 JSON 对象修改为 `const toml::table&`。
* **通用验证逻辑**: 在 `BaseStrategy` 中利用 C++17 结构化绑定和 `toml++` 迭代器重写了通用规则检查（如数值类型、Hex 颜色格式）及统计项的递归验证。
* **Facade 层更新**: `QueryFacade` 与 `ConverterFacade` 及其下属 Rule 类 (`MainRule`, `MappingRule`, `DurationRule`) 均已更新以支持 TOML 节点的类型检查与结构验证。


* **Reports 格式化器适配** (新增):
* **配置类重构**: 完成 `Monthly` 与 `Period` 模块下基类配置 (`MonthBaseConfig`/`PeriodBaseConfig`) 及具体格式配置类 (`Tex`/`Typ`/`Md`) 的构造函数重写，完全适配 `toml::table` 数据源。
* **DLL 接口升级**: 更新所有格式化器插件的 `create_formatter` 导出接口，支持直接解析传入的 TOML 配置字符串，并修复了 `toml::parse_result` 类型的传递与解引用逻辑。
* **样式组件修复**: 修正 `TexStyleConfig` 与 `TypstStyleConfig` 中 `value_or` 的左值引用推导问题，以及 `TomlLoaderUtils` 中 `keyword_colors` 映射构建时的键类型转换 (`string_view` -> `string`) 问题。

### Chore (杂项)

* **依赖更新**: 引入 `toml++` 库替代 `nlohmann/json` 作为核心配置解析引擎。
* **代码清理**: 移除了不再使用的 JSON 解析辅助代码，统一了配置读取与验证的异常处理机制。

## v0.4.1.4

### 
