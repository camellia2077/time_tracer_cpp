## v0.4.2.0 - 2026-01-16

### æ ¸å¿ƒæ¶æ„é‡æ„ (Architecture Refactoring)

æœ¬æ¬¡æ›´æ–°çš„æ ¸å¿ƒç›®æ ‡æ˜¯**å•ä¸€èŒè´£ (Single Responsibility)** å’Œ **æ•°æ®æµè§£è€¦**ã€‚

* **Serializer æ¨¡å—ç‹¬ç«‹**:
* ä» `Converter` å’Œ `Importer` ä¸­å‰¥ç¦»äº†æ‰€æœ‰ JSON ç›¸å…³çš„å¤„ç†é€»è¾‘ã€‚
* æ–°å¢é¡¶çº§æ¨¡å— `src/serializer`ï¼ŒåŒ…å« `LogSerializer` (Struct -> JSON) å’Œ `LogDeserializer` (JSON -> Struct)ã€‚
* å®ç°äº† `Core` å±‚å¯¹æ•°æ®æ ¼å¼è½¬æ¢çš„ç›´æ¥æ§åˆ¶ï¼Œä¸å†ä¾èµ–å…·ä½“çš„ä¸šåŠ¡æ¨¡å—ã€‚


* **Validator æ¨¡å—ç‹¬ç«‹**:
* å°†åˆ†æ•£åœ¨ `Converter` ä¸­çš„éªŒè¯é€»è¾‘æå–ä¸ºé¡¶çº§æ¨¡å— `src/validator`ã€‚
* åŒºåˆ†äº† **æºæ–‡ä»¶éªŒè¯ (Source Validator)** å’Œ **è¾“å‡ºé€»è¾‘éªŒè¯ (Output Validator)**ã€‚
* `Converter` æ¨¡å—ç°åœ¨å˜å¾—çº¯ç²¹ï¼Œåªè´Ÿè´£ "Text -> Struct" çš„è½¬æ¢ï¼Œä¸å†æ‰¿æ‹…è£åˆ¤å‘˜çš„è§’è‰²ã€‚


* **Converter æ¨¡å—çº¯åŒ–**:
* ç§»é™¤äº† `JsonWriter`ï¼ŒConverter ä¸å†è´Ÿè´£æ–‡ä»¶è¾“å‡ºã€‚
* ç°åœ¨ä¸“æ³¨äºå°†åŸå§‹æ–‡æœ¬è§£æä¸ºå†…å­˜ä¸­çš„ `DailyLog` ç»“æ„ä½“ã€‚



### æ–°å¢ "Blink" ç¬æ—¶æµæ°´çº¿ (New Pipeline Mode)

å¼•å…¥äº†å…¨æ–°çš„å…¨å†…å­˜å¤„ç†æµç¨‹ï¼Œç¡®ä¿â€œé›¶åƒåœ¾æ•°æ®è½ç›˜â€ã€‚

* **å‘½ä»¤**: `blink` (åˆ«å `run-pipeline`)
* **å·¥ä½œæµ**:
1. **Validate Source (Memory)**: æ ¡éªŒæ–‡æœ¬æ ¼å¼ï¼Œå¤±è´¥å³ç»ˆæ­¢ã€‚
2. **Convert (Memory)**: è§£ææ–‡æœ¬ä¸ºç»“æ„ä½“ã€‚
3. **Serialize (Memory)**: ç»“æ„ä½“è½¬ JSON å¯¹è±¡ã€‚
4. **Validate Logic (Memory)**: æ ¡éªŒä¸šåŠ¡é€»è¾‘ï¼ˆå¦‚ç¡çœ æ—¶é—´è¿ç»­æ€§ã€æ´»åŠ¨æ•°é‡ï¼‰ï¼Œå¤±è´¥å³ç»ˆæ­¢ã€‚
5. **Persistence**: åªæœ‰ä¸Šè¿°æ­¥éª¤**å…¨éƒ¨æˆåŠŸ**ï¼Œæ‰ä¼šæ‰§è¡Œï¼š
* (Optional) å°† JSON å†™å…¥ç£ç›˜ã€‚
* (Core -> Importer) å°†ç»“æ„ä½“ç›´æ¥æ³¨å…¥æ•°æ®åº“ï¼Œæ— éœ€äºŒæ¬¡IOã€‚




* **ä¼˜åŠ¿**: å½»åº•é¿å…äº†å› é€»è¾‘é”™è¯¯äº§ç”Ÿçš„â€œè„â€ JSON æ–‡ä»¶æˆ–æ•°æ®åº“è®°å½•ï¼ŒèŠ‚çœIOèµ„æºã€‚

### æ¨¡å—ä¸åŠŸèƒ½æ”¹è¿› (Improvements)

* **CLI (å‘½ä»¤è¡Œå·¥å…·)**:
* ä¿®å¤äº† `run-pipeline` ä¸ `blink` å‘½ä»¤çš„åˆ«åå†²çªé—®é¢˜ã€‚
* ä¿®å¤äº† `export` å‘½ä»¤ä¸­ `all-day` æ‹¼å†™é”™è¯¯å¯¼è‡´æ— æ³•è¯†åˆ«çš„é—®é¢˜ (ä¿®æ­£ä¸º `all-daily`)ã€‚
* `validate-source` å‘½ä»¤ç°åœ¨æ‰§è¡Œå…¨é“¾è·¯å†…å­˜éªŒè¯ï¼ˆDry Runï¼‰ï¼Œä¸ç”Ÿæˆä»»ä½•æ–‡ä»¶ã€‚


* **Validator (éªŒè¯å™¨)**:
* ä¼˜åŒ– `StructureRules`: å…è®¸æ–‡ä»¶ä¸­å‡ºç°å¤šæ¬¡ç›¸åŒçš„å¹´ä»½å¤´ï¼ˆä¾‹å¦‚å¤šä¸ª `y2025` å—ï¼‰ï¼Œåªè¦å¹´ä»½ä¸å€’é€€å³å¯ï¼Œæé«˜äº†å¯¹åˆ†å—è®°å½•ä¹ æƒ¯çš„å…¼å®¹æ€§ã€‚
* è§£å†³äº†éªŒè¯å™¨åœ¨å†…å­˜æ¨¡å¼ä¸‹é”™è¯¯æŠ¥å‘Šâ€œæ‰¾ä¸åˆ° .txt æ–‡ä»¶â€çš„æ—¥å¿—é—®é¢˜ã€‚


* **Importer (å¯¼å…¥å™¨)**:
* æ”¯æŒ**å†…å­˜ç›´è¿æ¨¡å¼** (`import_from_memory`)ï¼šç›´æ¥æ¥æ”¶ `vector<DailyLog>` è¿›è¡Œå…¥åº“ï¼Œä¸å†å¼ºåˆ¶ä¾èµ–ç£ç›˜ä¸Šçš„ JSON æ–‡ä»¶ã€‚
* ä¿ç•™äº†ç‹¬ç«‹ `import` å‘½ä»¤ï¼Œç”¨äºä»ç°æœ‰ JSON æ–‡ä»¶æ¢å¤æ•°æ®ã€‚



### Bug ä¿®å¤ (Bug Fixes)

* ä¿®æ­£äº† `cli/commands/pipeline/Convert.cpp` ä¸­æœªå¼€å¯æºæ–‡ä»¶éªŒè¯å¯¼è‡´å¯èƒ½ç”Ÿæˆé”™è¯¯æ•°æ®çš„é—®é¢˜ã€‚



## v0.4.2.1 - 2026-01-17

### ğŸ—ï¸ é‡æ„ (Refactor)

* **æ¶æ„åˆ†å±‚ä¸ç›®å½•é‡ç»„**ï¼š
* å°† CLI æ¨¡å—æ˜ç¡®æ‹†åˆ†ä¸º **`framework`** (é€šç”¨æ¡†æ¶å±‚) å’Œ **`impl`** (ä¸šåŠ¡å®ç°å±‚)ã€‚
* `framework` åŒ…å«æ ¸å¿ƒæœºåˆ¶ï¼ˆParser, Registry, Command Interface, IOï¼‰ï¼Œä¸å†åŒ…å«ä»»ä½•å…·ä½“ä¸šåŠ¡é€»è¾‘ã€‚
* `impl` åŒ…å«å…·ä½“å‘½ä»¤å®ç°ï¼ˆ`ingest`, `export` ç­‰ï¼‰åŠåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚

* **æ ¸å¿ƒç»„ä»¶è§£è€¦ (Dependency Breaking)**ï¼š
* **CommandRegistry æ¨¡æ¿åŒ–**ï¼šå°† `CommandRegistry` é‡æ„ä¸º `CommandRegistry<ContextT>` æ¨¡æ¿ç±»ï¼Œå½»åº•åˆ‡æ–­äº†æ¡†æ¶å±‚å¯¹ä¸šåŠ¡å±‚ `AppContext` çš„ä¾èµ–ï¼Œå®ç°äº†ä¾èµ–å€’ç½®ã€‚
* **ä¸Šä¸‹æ–‡éš”ç¦»**ï¼š`framework` ä»…ä¾èµ–è½»é‡çº§æ¥å£æˆ–æ¨¡æ¿å‚æ•°ï¼Œä¸å†å¼•ç”¨ `cli/impl` ä¸‹çš„ä»»ä½•å¤´æ–‡ä»¶ã€‚


* **å‘½åè§„èŒƒç»Ÿä¸€ (Google C++ Style)**ï¼š
* **æ–‡ä»¶å**ï¼šå…¨é‡è¿ç§»è‡³ **snake_case**ï¼ˆå¦‚ `Command.hpp` -> `i_command.hpp`, `Controller.cpp` -> `cli_application.cpp`ï¼‰ï¼Œè§£å†³äº†è·¨å¹³å°å¤§å°å†™æ•æ„Ÿé—®é¢˜ã€‚
* **ç±»åä¸æ–¹æ³•**ï¼šç»Ÿä¸€ä½¿ç”¨ **PascalCase**ï¼ˆå¦‚ `CommandRegistry::RegisterCommand`ï¼‰ï¼Œä¸æ–‡ä»¶åé£æ ¼å½¢æˆæ¸…æ™°çš„è§†è§‰åŒºåˆ†ã€‚
* **æ¥å£æ˜ç¡®**ï¼šå°†å‘½ä»¤åŸºç±»é‡å‘½åä¸º `ICommand`ï¼Œæ˜ç¡®å…¶æ¥å£å±æ€§ã€‚


## v0.4.2.2 - 2026-01-17

### ä¿®å¤ä¸æ„å»ºä¼˜åŒ– (Fixes & Build)

* **ä¿®å¤ PCH å¼•å…¥å¯¼è‡´çš„ç¬¦å·å†²çª**ï¼šè§£å†³äº†æ›´æ–°é¢„ç¼–è¯‘å¤´ï¼ˆ`pch.hpp`ï¼‰åï¼Œå› å…¨å±€å¯è§æ€§æ‰©å¤§è€Œæš´éœ²çš„ç±»/ç»“æ„ä½“å‘½åå†²çªé—®é¢˜ã€‚
* **å‘½åç©ºé—´éš”ç¦»**ï¼šå°† `PeriodMdConfig`ã€`PeriodTexConfig`ã€`PeriodTypConfig` åŠå…¶å¯¹åº”çš„ Formatter ç±»ç§»å…¥ `reporting` å‘½åç©ºé—´ï¼Œé¿å…ä¸ `ReportConfigModels.hpp` ä¸­çš„åŒåæ•°æ®ç»“æ„å‘ç”Ÿé‡å®šä¹‰å†²çªã€‚
* **æ¶ˆé™¤é‡åæ­§ä¹‰**ï¼šå°† `ConverterConfig` ä¸­çš„ `DurationRule` ç»“æ„ä½“é‡å‘½åä¸º `DurationMappingRule`ï¼Œè§£å†³äº†ä¸ Validator æ¨¡å—ä¸­ `DurationRule` ç±»çš„å‘½åå†²çªã€‚


* **ä¿®å¤é“¾æ¥ä¸ ODR è¿è§„**ï¼šç§»é™¤äº† `ProjectResolver.cpp` ä¸­æœ¬åœ°é™æ€å®šä¹‰çš„ `split_string` å‡½æ•°ï¼Œç»Ÿä¸€ä½¿ç”¨ `common/utils/StringUtils.hpp` ä¸­çš„å…±äº«å®ç°ï¼Œè§£å†³äº†ä¸ PCH ä¸­å…¨å±€å£°æ˜çš„ç¬¦å·å†²çªã€‚
* **å¤´æ–‡ä»¶è§„èŒƒ**ï¼šä¸º `ProjectResolver.hpp` è¡¥å……äº†ç¼ºå¤±çš„ Include Guardã€‚


## v0.4.2.3 - 2026-01-18


### Refactor (é‡æ„)
* **Global Naming Standardization**: å…¨é¢æ‰§è¡Œ **Google C++ Style** å‘½åè§„èŒƒï¼Œå°†æ‰€æœ‰æ ¸å¿ƒæ¨¡å—ï¼ˆ`core`, `converter`, `importer`, `bootstrap`ï¼‰çš„æºæ–‡ä»¶ä¸å¤´æ–‡ä»¶ç”± PascalCaseï¼ˆå¤§é©¼å³°ï¼‰é‡å‘½åä¸º **snake_case**ï¼ˆå°å†™ä¸‹åˆ’çº¿ï¼‰ã€‚
    * *ç›®çš„*: æå‡è·¨å¹³å°å…¼å®¹æ€§ï¼ˆLinux/Windows æ–‡ä»¶åå¤§å°å†™æ•æ„Ÿæ€§å·®å¼‚ï¼‰ï¼Œç»Ÿä¸€å·¥ç¨‹é£æ ¼ã€‚
    * *ç¤ºä¾‹*: `ReportHandler.hpp` â†’ `report_handler.hpp`, `DBManager.cpp` â†’ `db_manager.cpp`.
* **Dependency Updates**: å…¨é‡æ›´æ–°äº†é¡¹ç›®ä¸­çš„ `#include` å¼•ç”¨è·¯å¾„åŠ Include Guardsï¼Œç¡®ä¿ä¸æ–°çš„æ–‡ä»¶ç³»ç»Ÿç»“æ„ä¸€è‡´ã€‚
* **Build System**: åŒæ­¥æ›´æ–°äº† `CMakeLists.txt` ä¸­çš„æºæ–‡ä»¶åˆ—è¡¨ï¼Œé€‚é…é‡å‘½ååçš„æ–‡ä»¶è·¯å¾„ã€‚





## v0.4.2.4 - 2026-01-19

### æ›´æ–°æ—¥å¿—ï¼šConverter æ¶æ„è§£è€¦ä¸é…ç½®é‡æ„

æœ¬æ¬¡æ›´æ–°ä¸»è¦é›†ä¸­åœ¨ **Converterï¼ˆè½¬æ¢å™¨ï¼‰æ¨¡å—çš„æ¶æ„è§£è€¦** ä¸ **é…ç½®åŠ è½½æœºåˆ¶çš„é‡æ„**ï¼Œæ—¨åœ¨å®ç°ä¸šåŠ¡é€»è¾‘ä¸é…ç½®æ ¼å¼çš„å®Œå…¨åˆ†ç¦»ï¼Œå¹¶ä¿®å¤äº†é‡æ„è¿‡ç¨‹ä¸­çš„è·¯å¾„ä¾èµ–é—®é¢˜ã€‚

### Refactor (é‡æ„)

* **é…ç½®æ•°æ®åŒ– (Pure Data Model)**
* **å˜æ›´**ï¼šå°†åŸæœ‰çš„ `ConverterConfig` ç±»ï¼ˆåŒ…å« Getter/Setter å’Œé€»è¾‘ï¼‰æ›¿æ¢ä¸ºçº¯æ•°æ®ç»“æ„ä½“ (`struct`)ã€‚
* **ä½ç½®**ï¼šæ–°æ¨¡å‹å®šä¹‰åœ¨ `common/config/models/converter_config_models.hpp` ä¸­ï¼Œä»…åŒ…å« `text_mapping`ã€`duration_mappings` ç­‰å…¬å¼€æˆå‘˜å˜é‡ã€‚
* **æ”¶ç›Š**ï¼š`converter` æ¨¡å—ä¸å†ä¾èµ–å…·ä½“çš„é…ç½®æ–‡ä»¶æ ¼å¼ï¼ˆå¦‚ TOMLï¼‰ï¼Œä»…ä¾èµ–æ ‡å‡†çš„ C++ æ•°æ®ç»“æ„ã€‚


* **èŒè´£åˆ†ç¦» (Separation of Concerns)**
* **Config å±‚**ï¼šæ–°å¢ `TomlConverterConfigLoader`ï¼Œä¸“é—¨è´Ÿè´£è¯»å– TOML æ–‡ä»¶ã€å¤„ç†é…ç½®åˆå¹¶ä»¥åŠå°†æ•°æ®å¡«å……åˆ° Struct ä¸­ã€‚
* **Core å±‚**ï¼šè´Ÿè´£æµç¨‹ç¼–æ’ã€‚`PipelineManager` é€šè¿‡å·¥å‚è°ƒç”¨ Loader è·å–é…ç½®å¯¹è±¡ï¼Œç„¶åå°†å…¶æ³¨å…¥åˆ° Converter ä¸­ã€‚
* **Converter å±‚**ï¼šå®Œå…¨ç§»é™¤äº†æ–‡ä»¶è¯»å–å’Œ TOML è§£æä»£ç ã€‚æ‰€æœ‰ç»„ä»¶ï¼ˆå¦‚ `TextValidator`ï¼‰ç°åœ¨é€šè¿‡æ„é€ å‡½æ•°æ¥æ”¶å‡†å¤‡å¥½çš„ `ConverterConfig` ç»“æ„ä½“ã€‚



### Fix (ä¿®å¤)

* **å¤´æ–‡ä»¶å¼•ç”¨è·¯å¾„ä¿®æ­£ (Include Path Corrections)**
* **é—®é¢˜**ï¼šç”±äº `ConverterConfig` ä» `converter/config/` ç§»åŠ¨åˆ°äº† `common/config/models/`ï¼Œå¯¼è‡´éƒ¨åˆ†ä¾èµ–è¯¥é…ç½®çš„æ¨¡å—å‡ºç° "No such file or directory" ç¼–è¯‘é”™è¯¯ã€‚
* **ä¿®æ­£**ï¼šæ›´æ–°äº†ä»¥ä¸‹æ–‡ä»¶ä¸­çš„ `#include` è·¯å¾„ï¼ŒæŒ‡å‘æ–°çš„ `common/config/models/converter_config_models.hpp`ï¼š
* `validator/txt/facade/TextValidator.hpp`
* `validator/txt/rules/LineRules.hpp`
* `config/loader/toml_converter_config_loader.hpp`



## v0.4.2.5 - 2026-01-19

#### 1. å¸®åŠ©ç³»ç»Ÿé‡æ„ (CLI Documentation Refactoring)

* **å•ä¸€çœŸç†æº (Single Source of Truth)**:
* åºŸå¼ƒäº†åˆ†æ•£ä¸”ç¡¬ç¼–ç çš„ `HelpFormatter` æ‰“å°é€»è¾‘ã€‚
* åœ¨ `ICommand` æ¥å£ä¸­æ–°å¢ `get_help()` æ–¹æ³•ï¼Œå¹¶åœ¨æ‰€æœ‰å…·ä½“å‘½ä»¤ç±»ï¼ˆ`Ingest`, `Convert` ç­‰ï¼‰ä¸­å®ç°äº†è‡ªæˆ‘æè¿°ã€‚
* ç°åœ¨ï¼Œå‘½ä»¤çš„**å‚æ•°å®šä¹‰** (`get_definitions`) ä¸ **å¸®åŠ©æè¿°** (`get_help`) å‡åœ¨å‘½ä»¤ç±»å†…éƒ¨é—­ç¯ï¼Œä¿®æ”¹ä»£ç é€»è¾‘æ—¶æ–‡æ¡£è‡ªåŠ¨åŒæ­¥ã€‚


* **åŠ¨æ€å¸®åŠ©ç”Ÿæˆ**:
* é‡æ„ `HelpFormatter` ä¸ºé€šç”¨æ¸²æŸ“å¼•æ“ï¼Œæ ¹æ® `CommandRegistry` ä¸­çš„å‘½ä»¤å®ä¾‹åŠ¨æ€ç”Ÿæˆæ ¼å¼ç»Ÿä¸€çš„ Usage æ–‡æ¡£ã€‚


* **å…¥å£é€»è¾‘ç®€åŒ–**:
* ä¼˜åŒ– `main_cli.cpp`ï¼Œç§»é™¤å¯¹ `print_full_usage` çš„ç›´æ¥è°ƒç”¨ã€‚ç»Ÿä¸€å°†æ— å‚è°ƒç”¨è½¬æ¢ä¸º `--help` å‚æ•°ï¼Œå…¨æƒå§”æ‰˜ç»™ `CliApplication` å¤„ç†ï¼Œå®ç°äº†å¸®åŠ©ç³»ç»Ÿä¸ä¸šåŠ¡é€»è¾‘çš„ç»Ÿä¸€åˆ†å‘ã€‚



#### 2. æ¡†æ¶æ¼”è¿›ä¸ä»£ç è´¨é‡ (Framework Evolution & Code Quality)

* **ä¿®å¤æ¡†æ¶å±‚æŠ½è±¡æ³„æ¼ (Fix Framework Abstraction Leak)**:
* é‡æ„ `CommandParser`ï¼Œå½»åº•ç§»é™¤äº†å†…éƒ¨å¯¹ç‰¹å®šä¸šåŠ¡å‚æ•°ï¼ˆå¦‚ `--db`, `--date-check`ï¼‰çš„ç¡¬ç¼–ç æ£€æŸ¥ã€‚
* å¼•å…¥ `ParserConfig` é…ç½®ç»“æ„ï¼Œæ”¯æŒç”±åº”ç”¨å±‚ï¼ˆ`CliApplication`ï¼‰æ³¨å…¥å…¨å±€å‚æ•°è¿‡æ»¤è§„åˆ™ï¼Œå®ç°äº†æ¡†æ¶æ ¸å¿ƒä¸ä¸šåŠ¡é€»è¾‘çš„æ§åˆ¶åè½¬ (IoC)ã€‚


* **ç»Ÿä¸€å‘½ä»¤æ‰§è¡ŒèŒƒå¼ (Standardize Command Execution)**:
* å…¨çº¿å®è£… `CommandValidator`ï¼šæ‰€æœ‰å‘½ä»¤ç°åœ¨å¼ºåˆ¶é€šè¿‡ç»Ÿä¸€çš„éªŒè¯å™¨è·å–å‚æ•°ã€‚
* æ¶ˆé™¤æ‰‹åŠ¨è§£æåå‘³é“ï¼šç§»é™¤äº† `execute` æ–¹æ³•ä¸­ä¸å®‰å…¨çš„ç´¢å¼•è®¿é—®å’Œæ‰‹åŠ¨å­—ç¬¦ä¸²åŒ¹é…ï¼Œæ”¹ä¸ºä½¿ç”¨ `ParsedArgs` å¯¹è±¡å®‰å…¨è·å–å‚æ•°ã€‚

#### 3. æ¶æ„é‡æ„ (Architecture Refactoring)

* **å¼•å…¥æœåŠ¡æ¥å£å±‚ (Dependency Inversion)**:
* æ–°å¢ `IWorkflowHandler` å’Œ `IReportHandler` çº¯è™šæ¥å£ã€‚
* `CLI` æ¨¡å—çš„æ‰€æœ‰ Command ç±»ç°åœ¨åªä¾èµ–æ¥å£å¼•ç”¨ï¼Œä¸å†ä¾èµ– `Core` æ¨¡å—çš„å…·ä½“å®ç°ç±»ï¼Œæ˜¾è‘—é™ä½äº†æ¨¡å—é—´è€¦åˆã€‚


* **è¯­ä¹‰å¯¹é½ä¸é‡å‘½å**:
* ç±»åç»Ÿä¸€ï¼š`RunPipelineCommand` -> `IngestCommand`ã€‚
* æ–¹æ³•ç»Ÿä¸€ï¼š`WorkflowHandler::run_full_pipeline_and_import` -> `run_ingest`ã€‚



### ä¸ºä»€ä¹ˆè¦è¿½æ±‚â€œé«˜å†…èšâ€ (Why High Cohesion?)

åœ¨æœ¬æ¬¡æ›´æ–°ä¸­ï¼Œæˆ‘ä»¬å°†å¸®åŠ©æ–‡æ¡£çš„æè¿°ä»å¤–éƒ¨çš„å·¥å…·ç±» (`HelpFormatter`) ç§»å›åˆ°äº†æ¯ä¸ªå…·ä½“çš„å‘½ä»¤ç±» (`IngestCommand` ç­‰) å†…éƒ¨ï¼Œè¿™æ˜¯å¯¹ **â€œé«˜å†…èš (High Cohesion)â€** åŸåˆ™çš„å…¸å‹å®è·µã€‚

#### 2. æœ¬æ¬¡é‡æ„å¸¦æ¥çš„å…·ä½“ä¼˜åŠ¿ï¼š

* **ç»´æŠ¤åŸå­æ€§ (Atomic Maintenance)**
* **ä»¥å‰ï¼ˆä½å†…èšï¼‰**ï¼šå½“ä½ ä¿®æ”¹ `IngestCommand` å¢åŠ ä¸€ä¸ª `--verbose` å‚æ•°æ—¶ï¼Œä½ å¿…é¡»è®°å¾—åˆ° `HelpFormatter.cpp` å»ä¿®æ”¹æ‰“å°å­—ç¬¦ä¸²ã€‚**é€»è¾‘**åœ¨ A å¤„ï¼Œ**æ–‡æ¡£**åœ¨ B å¤„ã€‚å¼€å‘è€…ç»å¸¸å¿˜è®°ä¿®æ”¹ Bï¼Œå¯¼è‡´æ–‡æ¡£è…çƒ‚ï¼ˆDocument Rotï¼‰ã€‚
* **ç°åœ¨ï¼ˆé«˜å†…èšï¼‰**ï¼š`IngestCommand` åŒ…å«äº†å…³äºâ€œæ‘„å…¥â€è¿™ä¸€è¡Œä¸ºçš„æ‰€æœ‰ä¿¡æ¯ï¼šå®ƒæ€ä¹ˆè·‘ (`execute`)ã€å®ƒéœ€è¦ä»€ä¹ˆå‚æ•° (`get_definitions`)ã€å®ƒæ˜¯å¹²ä»€ä¹ˆçš„ (`get_help`)ã€‚ä¿®æ”¹é€»è¾‘æ—¶ï¼Œä½ åœ¨åŒä¸€ä¸ªæ–‡ä»¶ä¸­å°±èƒ½æ›´æ–°æ–‡æ¡£ï¼Œä¿è¯äº†ä¿®æ”¹çš„åŸå­æ€§ã€‚


* **é™ä½è®¤çŸ¥è´Ÿè· (Reduced Cognitive Load)**
* å¼€å‘è€…é˜…è¯»ä»£ç æ—¶ï¼Œä¸éœ€è¦åœ¨å¤šä¸ªæ–‡ä»¶é—´åå¤è·³è½¬æ¥ç†è§£ä¸€ä¸ªå‘½ä»¤çš„å®Œæ•´é¢è²Œã€‚`Command` ç±»æˆä¸ºäº†è‡ªåŒ…å«çš„å•å…ƒï¼Œé˜…è¯»è¯¥æ–‡ä»¶å³å¯æŒæ¡è¯¥å‘½ä»¤çš„æ‰€æœ‰ç»†èŠ‚ã€‚


* **ç¬¦åˆå¼€é—­åŸåˆ™ (Open/Closed Principle)**
* **ä»¥å‰**ï¼šæ¯æ–°å¢ä¸€ä¸ªå‘½ä»¤ï¼Œå¿…é¡»å»ä¿®æ”¹ `HelpFormatter` çš„ `print_full_usage` å‡½æ•°ï¼ˆä¿®æ”¹ç°æœ‰ä»£ç ï¼‰ã€‚
* **ç°åœ¨**ï¼šæ–°å¢å‘½ä»¤åªéœ€ç¼–å†™æ–°çš„ Command ç±»å¹¶æ³¨å†Œã€‚`HelpFormatter` å˜æˆäº†é€šç”¨çš„æ¸²æŸ“å™¨ï¼Œæ— éœ€ä¿®æ”¹ä»»ä½•ç°æœ‰ä»£ç å³å¯è‡ªåŠ¨æ”¯æŒæ–°å‘½ä»¤ã€‚

### ä¿®å¤ä¸ä¼˜åŒ– (Fixes & Improvements)

* **ç¼–è¯‘é”™è¯¯ä¿®å¤**:
* ä¿®å¤äº† `IngestCommand` ä¸­è¯•å›¾è®¿é—®ä¸å­˜åœ¨çš„é…ç½®é¡¹ `save_processed_output` å¯¼è‡´çš„ç¼–è¯‘å¤±è´¥ã€‚
* æ”¹ä¸ºåœ¨ Command å†…éƒ¨é»˜è®¤å¼€å¯ä¿å­˜ (`true`)ï¼Œå¹¶æ”¯æŒé€šè¿‡ `--no-save` å‚æ•°è¿›è¡Œè¦†ç›–ï¼Œä¸å†å¼ºä¾èµ–é…ç½®æ–‡ä»¶ä¸­çš„å­—æ®µã€‚
* **[æ–°å¢] ä¿®å¤é“¾æ¥é”™è¯¯**: è¡¥å…¨äº† `ParsedArgs` ç±»çš„å®ç°æ–‡ä»¶ (`arg_definitions.cpp`) å¹¶å°†å…¶åŠ å…¥æ„å»ºç³»ç»Ÿï¼Œè§£å†³äº† `undefined reference` é—®é¢˜ã€‚


* **ä¾èµ–ç®¡ç†ä¼˜åŒ–**:
* `AppContext` æ”¹ä¸ºæŒæœ‰æ¥å£æŒ‡é’ˆï¼Œç”± `CliApplication` è´Ÿè´£å…·ä½“ç±»çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†å’Œä¾èµ–æ³¨å…¥ã€‚







## v0.4.2.6 - 2026-01-19

### Refactoring: Validator & CLI Architecture (éªŒè¯å™¨ä¸CLIæ¶æ„é‡æ„)

æœ¬æ¬¡æ›´æ–°å¯¹éªŒè¯æ¨¡å—è¿›è¡Œäº†æ·±åº¦é‡æ„ï¼Œæ—¨åœ¨æ˜ç¡®â€œè¯­æ³•æ£€æŸ¥â€ä¸â€œé€»è¾‘æ ¡éªŒâ€çš„è¾¹ç•Œï¼Œå¹¶ä¿®æ­£äº† CLI å±‚ä¸ Core å±‚èŒè´£ä¸æ¸…çš„é—®é¢˜ã€‚

#### 1. è¯­ä¹‰åŒ–é‡å‘½å (Semantic Renaming)

ä¸ºäº†æ›´å‡†ç¡®åœ°åæ˜ éªŒè¯å™¨çš„èŒè´£ï¼Œæˆ‘ä»¬å¯¹ç›¸å…³å‘½ä»¤å’Œç»„ä»¶è¿›è¡Œäº†é‡å‘½åï¼š

* **`validate_source` â†’ `validate_structure**`
* **å˜æ›´ç†ç”±**ï¼šåŸåç§°ä»…æŒ‡ä»£â€œæºæ–‡ä»¶â€ï¼Œæ–°åç§°æ˜ç¡®äº†è¯¥æ­¥éª¤åªå…³æ³¨ TXT æ–‡ä»¶çš„**è¯­æ³•ç»“æ„**ï¼ˆå¦‚å¹´ä»½å¤´ã€æ—¶é—´æ ¼å¼ã€ç¼©è¿›ï¼‰ï¼Œè€Œä¸æ¶‰åŠä¸šåŠ¡é€»è¾‘ã€‚
* **CLI å‘½ä»¤**ï¼š`time_tracker validate-structure`


* **`validate_output` â†’ `validate_logic**`
* **å˜æ›´ç†ç”±**ï¼šåŸåç§°æš—ç¤ºâ€œéªŒè¯è¾“å‡ºç»“æœâ€ï¼Œæ–°åç§°å¼ºè°ƒäº†è¯¥æ­¥éª¤çš„æ ¸å¿ƒæ˜¯éªŒè¯**ä¸šåŠ¡é€»è¾‘è¿è´¯æ€§**ï¼ˆå¦‚è·¨å¤©ç¡çœ é—­ç¯ã€æ—¥æœŸè¿ç»­æ€§ã€æ´»åŠ¨é‡å ï¼‰ï¼Œæ— è®ºæ•°æ®å¤„äºå†…å­˜è¿˜æ˜¯æ–‡ä»¶æ€ã€‚
* **CLI å‘½ä»¤**ï¼š`time_tracker validate-logic`



#### 2. æ¶æ„åˆ†å±‚ä¼˜åŒ– (Layer Separation)

ä¿®æ­£äº† CLI å±‚åŒ…å«ä¸šåŠ¡é€»è¾‘çš„â€œä»£ç å¼‚å‘³â€ï¼Œä¸¥æ ¼éµå¾ªåˆ†å±‚æ¶æ„åŸåˆ™ï¼š

* **é€»è¾‘ä¸‹æ²‰ (Logic Encapsulation)**ï¼š
* ç§»é™¤äº† CLI Command ç±»ï¼ˆ`ValidateStructureCommand`, `ValidateLogicCommand`ï¼‰ä¸­ç›´æ¥åˆ›å»ºéªŒè¯å™¨å’Œéå†æ–‡ä»¶çš„é€»è¾‘ã€‚
* æ–°å¢ **`StructureValidatorStep`** å’Œ **`LogicValidatorStep`**ï¼Œå°†éªŒè¯æµç¨‹å®Œå…¨å°è£…åœ¨ Core å±‚çš„æµæ°´çº¿ï¼ˆPipelineï¼‰ä¸­ã€‚


* **CLI ç˜¦èº« (Thin CLI)**ï¼š
* CLI Command ç°åœ¨ä»…å……å½“â€œé…ç½®ç»„è£…è€…â€ï¼Œåªè´Ÿè´£è§£æå‚æ•°å¹¶è®¾ç½® `AppOptions`ï¼Œéšåå…¨æƒå§”æ‰˜ç»™ `PipelineManager` æ‰§è¡Œã€‚



#### 3. ä¾èµ–æ³¨å…¥ä¿®å¤ (Dependency Injection Fix)

* **Context è¡¥å…¨**ï¼šä¿®å¤äº† `AppContext` ä¸­ç¼ºå¤± `config` æˆå‘˜å¯¼è‡´éƒ¨åˆ† Command æ— æ³•è·å–å…¨å±€é…ç½®çš„ç¼–è¯‘é”™è¯¯ã€‚ç°åœ¨ `AppConfig` ä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶æ­£ç¡®æ³¨å…¥åˆ° Context ä¸­ã€‚



### ğŸ› Fixes & Improvements (ä¿®å¤ä¸æ”¹è¿›)

æœ¬æ¬¡æ›´æ–°ä¸»è¦ä¿®å¤äº†å¯¼å‡ºæ¨¡å—çš„æ¥å£è°ƒç”¨é”™è¯¯ï¼Œå¹¶è¿›ä¸€æ­¥è´¯å½»â€œç˜¦ CLIâ€åŸåˆ™ï¼Œå°†æ‰¹é‡æŸ¥è¯¢çš„å¾ªç¯é€»è¾‘ä¸‹æ²‰è‡³æ ¸å¿ƒå±‚ã€‚

#### 1. CLI é€»è¾‘ä¸‹æ²‰ (Logic Push-down)

* **æ‰¹é‡æŸ¥è¯¢é€»è¾‘ç§»è‡³ Core**ï¼š
* ä¹‹å‰ `query period 7,30` çš„å¾ªç¯é€»è¾‘æ˜¯åœ¨ CLI (`QueryCommand`) ä¸­å®ç°çš„ï¼Œè¿™ä¸ `ExportCommand` çš„å¤„ç†æ–¹å¼ä¸ä¸€è‡´ã€‚
* ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨æ ¸å¿ƒæ¥å£ `IReportHandler` ä¸­æ–°å¢äº† **`run_period_queries`** æ–¹æ³•ï¼Œå°†å‚æ•°è§£æåçš„åˆ—è¡¨ç›´æ¥ä¼ é€’ç»™ Core å¤„ç†ã€‚
* **å˜æ›´æ–‡ä»¶**ï¼š`cli/impl/commands/query/query_command.cpp` â†’ `core/reporting/report_handler.cpp`



#### 2. å¯¼å‡ºæ¨¡å—ç¼–è¯‘ä¿®å¤ (Export Compilation Fixes)

* **ä¿®æ­£æ–¹æ³•ç­¾åä¸åŒ¹é…**ï¼š
* ä¿®å¤äº† `ReportHandler` è°ƒç”¨ `Exporter` æ—¶çš„æ–¹æ³•åæ··æ·†é—®é¢˜ï¼ˆä¾‹å¦‚è¯¯å°†å•æ¬¡å¯¼å‡º `export_single_day_report` è°ƒç”¨ä¸ºæ‰¹é‡å¯¼å‡ºæ¥å£ï¼‰ã€‚
* ä¿®æ­£äº†æ‰¹é‡å¯¼å‡ºï¼ˆ`export_all_*`ï¼‰æ—¶çš„å‚æ•°ç±»å‹é”™è¯¯ï¼Œç¡®ä¿æ­£ç¡®ä¼ é€’ `FormattedReports` é›†åˆç»“æ„è€ŒéåŸå§‹å­—ç¬¦ä¸²å†…å®¹ã€‚
* **å˜æ›´æ–‡ä»¶**ï¼š`core/reporting/report_handler.cpp`



### (Git Commit Message)

Refactor: Rename validators and move logic to Core pipeline

1. Rename CLI commands:
   - validate_source -> validate_structure (syntax focus)
   - validate_output -> validate_logic (business logic focus)

2. Architecture improvements:
   - Moved validation orchestration from CLI to new Core Pipeline steps:
     - StructureValidatorStep
     - LogicValidatorStep
   - CLI commands now delegate execution to PipelineManager.

3. Fixes:
   - Added missing AppConfig to AppContext to fix compilation errors.


1. Architecture refinement (Thin CLI):
   - Moved the loop for batch period queries (e.g., "7,30") from `QueryCommand` to `ReportHandler::run_period_queries`.
   - CLI now strictly handles argument parsing and delegates the list to Core.

2. Fixes:
   - Fixed compilation errors in `ReportHandler.cpp` due to mismatched `Exporter` method calls.
   - Corrected argument types for `export_all_*` methods (passing map structures instead of strings).
   - Fixed naming confusion between single vs. bulk export methods.














