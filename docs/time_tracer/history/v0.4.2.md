## v0.4.2.0 - 2026-01-16

### 核心架构重构 (Architecture Refactoring)

本次更新的核心目标是**单一职责 (Single Responsibility)** 和 **数据流解耦**。

* **Serializer 模块独立**:
* 从 `Converter` 和 `Importer` 中剥离了所有 JSON 相关的处理逻辑。
* 新增顶级模块 `src/serializer`，包含 `LogSerializer` (Struct -> JSON) 和 `LogDeserializer` (JSON -> Struct)。
* 实现了 `Core` 层对数据格式转换的直接控制，不再依赖具体的业务模块。


* **Validator 模块独立**:
* 将分散在 `Converter` 中的验证逻辑提取为顶级模块 `src/validator`。
* 区分了 **源文件验证 (Source Validator)** 和 **输出逻辑验证 (Output Validator)**。
* `Converter` 模块现在变得纯粹，只负责 "Text -> Struct" 的转换，不再承担裁判员的角色。


* **Converter 模块纯化**:
* 移除了 `JsonWriter`，Converter 不再负责文件输出。
* 现在专注于将原始文本解析为内存中的 `DailyLog` 结构体。



### 新增 "Blink" 瞬时流水线 (New Pipeline Mode)

引入了全新的全内存处理流程，确保“零垃圾数据落盘”。

* **命令**: `blink` (别名 `run-pipeline`)
* **工作流**:
1. **Validate Source (Memory)**: 校验文本格式，失败即终止。
2. **Convert (Memory)**: 解析文本为结构体。
3. **Serialize (Memory)**: 结构体转 JSON 对象。
4. **Validate Logic (Memory)**: 校验业务逻辑（如睡眠时间连续性、活动数量），失败即终止。
5. **Persistence**: 只有上述步骤**全部成功**，才会执行：
* (Optional) 将 JSON 写入磁盘。
* (Core -> Importer) 将结构体直接注入数据库，无需二次IO。




* **优势**: 彻底避免了因逻辑错误产生的“脏” JSON 文件或数据库记录，节省IO资源。

### 模块与功能改进 (Improvements)

* **CLI (命令行工具)**:
* 修复了 `run-pipeline` 与 `blink` 命令的别名冲突问题。
* 修复了 `export` 命令中 `all-day` 拼写错误导致无法识别的问题 (修正为 `all-daily`)。
* `validate-source` 命令现在执行全链路内存验证（Dry Run），不生成任何文件。


* **Validator (验证器)**:
* 优化 `StructureRules`: 允许文件中出现多次相同的年份头（例如多个 `y2025` 块），只要年份不倒退即可，提高了对分块记录习惯的兼容性。
* 解决了验证器在内存模式下错误报告“找不到 .txt 文件”的日志问题。


* **Importer (导入器)**:
* 支持**内存直连模式** (`import_from_memory`)：直接接收 `vector<DailyLog>` 进行入库，不再强制依赖磁盘上的 JSON 文件。
* 保留了独立 `import` 命令，用于从现有 JSON 文件恢复数据。



### Bug 修复 (Bug Fixes)

* 修正了 `cli/commands/pipeline/Convert.cpp` 中未开启源文件验证导致可能生成错误数据的问题。



## v0.4.2.1 - 2026-01-17

### 🏗️ 重构 (Refactor)

* **架构分层与目录重组**：
* 将 CLI 模块明确拆分为 **`framework`** (通用框架层) 和 **`impl`** (业务实现层)。
* `framework` 包含核心机制（Parser, Registry, Command Interface, IO），不再包含任何具体业务逻辑。
* `impl` 包含具体命令实现（`ingest`, `export` 等）及应用程序生命周期管理。

* **核心组件解耦 (Dependency Breaking)**：
* **CommandRegistry 模板化**：将 `CommandRegistry` 重构为 `CommandRegistry<ContextT>` 模板类，彻底切断了框架层对业务层 `AppContext` 的依赖，实现了依赖倒置。
* **上下文隔离**：`framework` 仅依赖轻量级接口或模板参数，不再引用 `cli/impl` 下的任何头文件。


* **命名规范统一 (Google C++ Style)**：
* **文件名**：全量迁移至 **snake_case**（如 `Command.hpp` -> `i_command.hpp`, `Controller.cpp` -> `cli_application.cpp`），解决了跨平台大小写敏感问题。
* **类名与方法**：统一使用 **PascalCase**（如 `CommandRegistry::RegisterCommand`），与文件名风格形成清晰的视觉区分。
* **接口明确**：将命令基类重命名为 `ICommand`，明确其接口属性。


## v0.4.2.2 - 2026-01-17

### 修复与构建优化 (Fixes & Build)

* **修复 PCH 引入导致的符号冲突**：解决了更新预编译头（`pch.hpp`）后，因全局可见性扩大而暴露的类/结构体命名冲突问题。
* **命名空间隔离**：将 `PeriodMdConfig`、`PeriodTexConfig`、`PeriodTypConfig` 及其对应的 Formatter 类移入 `reporting` 命名空间，避免与 `ReportConfigModels.hpp` 中的同名数据结构发生重定义冲突。
* **消除重名歧义**：将 `ConverterConfig` 中的 `DurationRule` 结构体重命名为 `DurationMappingRule`，解决了与 Validator 模块中 `DurationRule` 类的命名冲突。


* **修复链接与 ODR 违规**：移除了 `ProjectResolver.cpp` 中本地静态定义的 `split_string` 函数，统一使用 `common/utils/StringUtils.hpp` 中的共享实现，解决了与 PCH 中全局声明的符号冲突。
* **头文件规范**：为 `ProjectResolver.hpp` 补充了缺失的 Include Guard。