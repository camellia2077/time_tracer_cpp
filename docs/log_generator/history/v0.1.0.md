## v0.1.0.0 - 2026-01-15

### 核心架构重构 (Core Architecture Refactoring)

本次更新专注于提升代码库的可维护性与扩展性，通过引入模块化设计将核心业务逻辑与程序入口解耦，全面升级配置系统，并进一步优化了模块间的依赖关系。

#### 配置系统升级 (Configuration System Upgrade)

* **格式迁移 (JSON to TOML)**: 配置文件格式由 JSON 全面迁移至 **TOML**，以提供更清晰的语法、支持注释及更好的可读性。
* 相关文件变更为：`activities_config.toml` 与 `mapping_config.toml`。


* **依赖引入**: 引入 **`tomlplusplus`** 库作为核心解析引擎，替代原有的 JSON 解析方案。
* **加载逻辑重构**: `ConfigLoader` 现专门负责 TOML 数据的映射逻辑，支持更灵活的配置项读取。
* **IO 与解析分离**: 遵循单一职责原则，`ConfigLoader` 不再直接操作文件，而是处理由 `io/FileManager` 读取的内存字符串。实现了业务逻辑与文件系统的完全解耦，提升了可测试性。

#### 核心代码变更 (Core Logic Refactoring)

* **入口瘦身**: `src/main.cpp` 已被重构为极简入口，仅负责实例化 `Core::Application`，所有业务编排逻辑下沉至 `core` 模块。
* **职责分离 (Handler Pattern)**: 将原 `Application` 类的巨型逻辑拆分为单一职责的处理器：
* `ConfigHandler`: 专职处理命令行解析、TOML 配置文件加载及数据验证。
* `WorkflowHandler`: 封装核心生成循环，协调生成器与文件 IO。
* `ReportHandler`: 统一管理性能计时与最终报告输出。


* **上下文管理**: 引入 `AppContext` 数据结构，实现了配置数据在各处理器间的显式传递，消除了隐式依赖。
* **依赖优化 (Data-Behavior Separation)**: 新增 `common/ConfigTypes.hpp` 存放纯数据结构 (DTOs)。此举使 `CommandLineParser` 和 `PerformanceReporter` 等组件不再依赖庞大的配置解析库 (toml++)，显著净化了模块依赖。
* **目录结构规范化**: `src/core` 内部细分为 `config/`, `workflow/`, `reporting/` 子模块，实现了物理层面的关注点分离。

#### 构建系统升级 (Build System Upgrade)

* **CMake 模块化**: 废弃了单体 `CMakeLists.txt`，采用模块化管理（位于 `cmake/` 目录）：
* `Sources.cmake`: 集中管理源文件列表。
* `CompilerOptions.cmake`: 独立配置编译优化与警告。
* `FileOperations.cmake`: 封装配置文件复制等构建任务（已更新为复制 `.toml` 文件）。
* `Dependencies.cmake` & `StandardSettings.cmake`: 管理依赖（新增 `tomlplusplus`）与标准版本。


* **逻辑简化**: 根目录 `CMakeLists.txt` 现仅作为调度脚本，大幅降低了阅读与维护门槛。


## v0.1.0.1 - 2026-01-15

### 性能优化 (Performance)

* **零拷贝字符串处理**: 在核心事件生成循环中，将 `std::string` 替换为 `std::string_view`，消除了活动名称和关键词的重复内存拷贝。
* **极速整数格式化**: 引入编译期静态查找表 `DIGITS`，将 0-59 的时间戳格式化速度提升至极致，完全绕过了 `std::format` 的运行时解析开销。
* **直接内存操作**: 在高频日志拼接路径中，使用 `std::string::append` 和 `push_back` 替代 `std::format`，减少了格式化层的指令消耗。
* **移除堆内存分配**: 将 `RemarkGenerator` 中的随机分布对象管理从 `std::unique_ptr` 改为 `std::optional`，实现了对象的栈上存储，消除了数百万次小对象的 `new/delete` 开销。
* **循环逻辑优化**:
* **Loop Peeling (循环剥离)**: 将 `LogGenerator` 中每月的“第一天”逻辑提取到循环外，消除了主循环中对 `if (day > 1)` 的重复判断。
* **分支预测优化**: 将 `EventGenerator` 中的“起床事件”逻辑移出循环，使主循环逻辑更加紧凑且无分支。



### 新功能 (Features)

* **多行每日备注支持**: `daily_remarks` 配置新增 `max_lines` 参数。系统现在可以根据配置随机生成 1 到 `max_lines` 行的每日备注，丰富了日志的细节表现。
* **配置驱动的行数控制**: 支持在 TOML 配置文件中动态调整备注行数上限，且向下兼容（默认值为 1）。


### 架构与性能 (Architecture & Performance)

* **多线程并行生成 (Parallel Generation)**: 引入 `std::future` 和 `std::async`，按年份并行执行日志生成任务，充分利用多核 CPU 性能。
* **内存复用机制 (Memory Reuse)**: 重构生成器接口，通过复用 `std::string` 缓冲区，避免了每月的重复内存分配，大幅降低内存碎片。
* **策略模式重构 (Strategy Pattern)**: 将通宵/睡眠逻辑从 `LogGenerator` 中剥离为独立的 `SleepScheduler` 策略类，显著提升了代码的可读性与可测试性。


## v0.1.0.2 - 2026-01-15

### 核心优化 (Core Optimizations)

* 
**实现有界并发 (Bounded Concurrency)**: 彻底重构了 `WorkflowHandler` 的并行逻辑 。不再根据年份无限制地创建线程，而是根据硬件核心数（`std::thread::hardware_concurrency`）限制同时运行的任务数量。


* **修复**: 解决了在大跨度年份（如 100 年）或高条目数（`--items`）生成时导致的 `std::bad_alloc` 内存崩溃问题。现在内存占用保持在极低且稳定的水平。

### 工程架构更新 (Architectural Updates)

* **头文件标准化**: 全量将项目内的 `.h` 后缀重命名为 `.hpp`，以明确其 C++ 模板与内联实现的属性。
* **CMake 构建系统同步**:
* 更新了 `CompilerOptions.cmake` 中的 `target_precompile_headers` 路径，确保预编译头文件正确指向 `src/pch.hpp` 。


* 优化了 `CCACHE` 查找逻辑，加速二次编译速度 。

### 架构重构 (Architectural Refactoring)

* **Generator 模块标准化分层**: 重新设计了 `generator` 模块的目录结构，实现了接口、实现、组件与策略的清晰分离，符合高内聚低耦合原则。
* **API Layer (`api/`)**: 存放 `ILogGenerator` 接口与工厂类，定义外部契约。
* **Implementation Layer (`impl/`)**: 存放 `LogGenerator` 核心编排逻辑，作为业务入口。
* **Component Layer (`components/`)**: 存放 `Day`, `Event`, `Remark` 生成器，专注于具体内容的生产。
* **Strategy Layer (`strategies/`)**: 独立出 `SleepScheduler`，将“通宵/睡眠”判定逻辑作为纯算法策略管理。

### 业务逻辑修正 (Business Logic Fixes)

* **单一事实来源 (Single Source of Truth)**: 移除了 `activities_config.toml` 中的 `common_activities` 配置项，强制将 `mapping_config.toml` 中的映射键（Keys）作为唯一的合法活动来源。
* **目的**: 确保生成器产生的数据严格符合下游 ETL/数据库程序的字典定义，杜绝产生无法入库的脏数据。


* **配置加载器瘦身**:
* 重构了 `ConfigLoader::load_from_content` 签名，删除了不再使用的 `activities_content` 参数。
* 清理了 `ConfigHandler` 中冗余的文件读取逻辑，消除了编译器关于 "unused parameter" 的警告。


* **校验逻辑更新**: 更新了 `ConfigFacade::validate`，移除了对重复活动的检查（因 TOML 键天然唯一），改为检查映射活动表是否为空。





### 改进 (Improvements)

* 
**优化性能报告 (Performance Reporting)**: 修改了控制台输出的统计文案，消除歧义 。


* 将 `total time` 更名为 **"Total Wall Time"**，明确表示物理流逝时间。
* 将生成和 IO 时间标记为 **"Cumulative"**（累计工时），并备注 `[Sum of all threads]`，解释了为何子项之和会大于总时间。


* **用户体验**: 在开始生成前增加了当前并行线程数的提示信息。


## v0.1.0.3 - 2026-01-21


1. **业务逻辑调整**：
* **取消跨年日期生成**：删除了每年 1 月份自动生成“上一年 12 月 31 日”数据的逻辑。现在生成数据严格从当年的 1 月 1 日开始。


2. **代码重构**：
* **文件名规范化**：所有源代码文件从 **大驼峰命名** (如 `LogGenerator.cpp`) 统一修改为 **小写下划线命名** (如 `log_generator.cpp`)，以符合 C++ 标准库风格。

3. **Include 路径绝对化**：
* **引用方式变更**：所有 #include 指令均修改为文件系统的绝对路径（包括同级目录文件），以强制消除路径搜索歧义，确保预处理器定位的唯一性。




