# 开发历史 (HISTORY.md)

本文档记录了项目开发的主要里程碑和重构。
详细的、逐步的开发日志（包括所有子版本）已被归档到 `docs/history/` 目录中。

---

## [0.3.24] - 2025-10-09
**里程碑：插件架构（第一阶段）- DLL 拆分**
* 将所有9个报表格式化器（日报、月报、周期报的 `md`, `tex`, `typ` 格式）从主程序中分离，编译为独立的动态链接库（DLL）。
* 更新了 `config_validator`（配置验证器）和 Python 测试脚本，以支持新的 `plugins` 目录结构和 DLL 命名规范。

---

## [0.3.23] - 2025-09-21
**里程碑：报表模块大规模重构**
* **引入策略模式**：创建 `StatisticsFormatter` 和 `IStatStrategy` 接口，彻底消除了日报格式化器（Md, Tex, Typ）中重复的统计数据格式化逻辑。
* **提取通用基类**：创建了 `DayBaseConfig`、`MonthBaseConfig`、`PeriodBaseConfig` 和 `BaseGenerator`，统一了所有报告的配置加载和生成流程。
* **新增配置开关**：JSON 配置中新增了 `show` 开关，允许用户自定义显示哪些统计项。
* **代码结构优化**：合并了 `QueryManager` 和 `ReportGenerator`，并将 `queries` 目录重命名为 `reports`。

---

## [0.3.22] - 2025-09-21
**里程碑：功能扩展与代码规范**
* **新增 "娱乐" 统计**：在 `generatedStats` 和数据库中新增了 `recreation` 相关字段，并在所有日报格式中支持其统计和导出。
* **重构工厂模式**：使用基于注册的工厂模式替换了 `switch` 语句，使其更符合开闭原则。
* **统一代码风格**：成员变量命名全部添加 `_` 后缀，使其符合 Google C++ 风格指南。
* **统一 `ProjectTree` 格式化**：扩展了 `IFormattingStrategy` 接口，将 LaTeX 的项目树格式化逻辑也并入了 `ProjectTreeFormatter`。

---

## [0.3.21] - 2025-09-19
**里程碑：新增配置验证器并扩展数据模型**
* 新增了一个独立的模块，用于验证所有报告格式化器的 `.json` 配置文件。
* 扩展了数据库和 `.json` 的数据模型，增加了 `totalExerciseTime`、`gamingTime`、`groomingTime` 和 `toiletTime` 等字段。
* 日报统计中新增了更详细的分类，如“无氧运动”、“有氧运动”和“洗漱时间”。
* 提取了通用的 `MarkdownUtils` 和 `TexUtils`，以复用代码。

---

## [0.3.20] - 2025-09-21
**里程碑：查询器 (Querier) 架构重构**
* 创建了 `BaseQuerier` 模板基类，统一了 `DayQuerier`、`MonthQuerier` 和 `PeriodQuerier` 的通用查询逻辑。
* 将数据查询与报告格式化完全解耦，并统一了格式化器的创建逻辑。
* 将所有 TeX 相关的辅助函数（如 Preamble、escape）整合到 `TexUtils`。

---

## [0.3.19] - 2025-09-15
**里程碑：全面转向 JSON 配置**
* 为所有报告查询器（日报、月报、周期报）新增了 JSON 配置文件支持。
* 移除了 `md`、`tex` 和 `typ` 格式化器中的硬编码设置（如字体、行距、颜色等），全部改为从 JSON 文件动态读取。

---

## [0.3.18] - 2025-09-15
**里程碑：数据模型扩展与规范化**
* 扩展了 `generatedStats` 以追踪新的日常活动，如 `grooming`（洗漱） 和 `toilet`（上厕所）。
* 统一了 `.json` 文件中的键名（例如 `topparent`/`parent` 改为 `parent`/`child`），使其与数据库的 schema 保持一致。

---

## [0.3.17] - 2025-09-13
**里程碑：代码结构优化（Facade 模式）**
* 引入 Facade（外观）设计模式，重构了 `SourceFileValidator`、`converter` 和 `db_inserter` 模块。
* 拆分了 `common_utils`，提高了模块的内聚性。
* 修复了因 `-Werror` 导致的“未使用参数”编译错误。

---

## [0.3.16] - 2025-09-13
**里程碑：功能 - 支持通宵情况的处理**
* 通过检测一天的第一行是否存在起床条目来判断“通宵”状态。
* 在通宵情况下，程序会将 `headers` 中的 `sleep` 设为 false，并将 `generatedStats` 中的 `sleepTime` 设为 0。
* 测试日志生成器已支持按 `-n` (`--nosleep`) 参数，按特定模式（1天通宵 -> 1天正常 -> 2天通宵...）生成通宵数据。

---

## [0.3.15] - 2025-09-13
**里程碑：优化 - 清理 JSON 输出**
* 在数据转换阶段，过滤掉了仅用于计算跨年睡眠的“衔接日”（例如 12-31）。
* 此修改确保了输出的 `.json` 文件只包含其所代表月份的有效天数数据，使中间数据更纯粹。

---

## [0.3.14] - 2025-09-12
**里程碑：功能 - 新增“锻炼”状态统计**
* 在 `.json` 的 `headers` 中新增了 `exercise` 字段（判断当天是否锻炼）。
* 在 `generatedStats` 中新增了 `exerciseTime` 字段，用于统计总锻炼秒数。
* 数据库插入和所有报告格式（md, typ, tex）均已支持 `exercise` 字段的输出。

---

## [0.3.13] - 2025-09-12
**里程碑：功能 - 支持活动备注**
* 支持使用 `;`、`//` 或 `#` 符号为 `.txt` 中的单行活动添加备注。
* 更新了 JSON 格式、数据库插入流程以及所有报表格式 (md, typ, tex) 以正确解析和显示备注。

---

## [0.3.8] - 2025-08-31
**里程碑：架构 - 引入 JSON 作为中间数据**
* 重构了核心解析流程，建立了 `.txt` -> `JSON` -> `Database` 的标准处理管线。
* 将所有的数据合法性验证逻辑从 `.txt` 文件转移到了 `.json` 文件，极大地简化了验证和解析的复杂度。

---










